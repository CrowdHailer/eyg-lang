<div  class="vstack bg-gray-50 wrap"><div  class="loose doc"><h1  class="text-2xl">Effects</h1><h2  class="text-lg max-w-2xl mx-auto">Choose</h2><p  class="max-w-2xl mx-auto">A random choice. 
Implementations can be handled to always return a fixed value or from a list or all.

The value passed when invoking the Choose effect is unit i.e. an empty record as behaviour is not defined by the caller of choose</p><pre  class="bg-gray-200">_ -> {
  let choose = _ -> perform Choose({})
  let always = value -> handle Choose(_arg -> resume -> resume(value))
  let _ = always(True({}))(_ -> {
    let first = choose({})
    let second = choose({})
    [first, second]
  })
  let _ = "[True, True]"
  vacant
}</pre><p  class="max-w-2xl mx-auto">choose both by resuming the exec function multiple times

Need to wrap the exec function to return a list of it's value so that it can be concatenated in the handler</p><pre  class="bg-gray-200">_ -> {
  let concat = vacant
  let choose = _ -> perform Choose({})
  let both = exec -> {
    let handler = _arg -> resume -> {
      let first = resume(True({}))
      let second = resume(False({}))
      concat(first)(second)
    }
    handle Choose(handler)(_ -> [exec({})])
  }
  let _ = both(_ -> {
    let first = choose({})
    let second = choose({})
    [first, second]
  })
  "[[True, True], [True, False], [False, True], [False, False]"
}</pre><h2  class="text-lg max-w-2xl mx-auto">Fail</h2><p  class="max-w-2xl mx-auto">Short circuit execution with a failure.

I'm not sure of naming here. Can I use Error for the union type i.e. in Ok | Error at the same time as it for the Effect</p><pre  class="bg-gray-200">_ -> {
  let result = {
    let ok = Ok
    let error = Error
    let fail = perform Error
    let expect = match {
      Ok value -> value
      Error reason -> fail(reason)
      vacant
    }
    let rescue = exec -> {
      let handler = reason -> _resume -> error(reason)
      handle Error(handler)(_ -> ok(exec({})))
    }
    {fail: fail, expect: expect, rescue: rescue}
  }
  vacant
}</pre><h2  class="text-lg max-w-2xl mx-auto">Log</h2><p  class="max-w-2xl mx-auto">Logs are an effect
</p><pre  class="bg-gray-200">{log: term -> perform Log(term), capture: {
  let handler = message -> k -> {
    let inner = k({})
    {logs: [message, ..inner.logs], ..inner}
  }
  run -> handle Log(handler)(_ -> {
    let return = run({})
    {return: return, logs: []}
  })
}}</pre><h2  class="text-lg max-w-2xl mx-auto">Async Await</h2><p  class="max-w-2xl mx-auto">Both async and await are implemented as effects and can be caught for test purposes</p></div><span  class="expand"></span><footer  class="bg-gray-800 cover">language</footer></div>