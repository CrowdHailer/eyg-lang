<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://unpkg.com/codeflask/build/codeflask.min.js"></script>
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  </head>
  <body class="bg-gray-100">
    <main class="w-full max-w-5xl mx-auto shadow p-2 my-6">
      <h1 class="text-5xl mb-6">Wisdom</h1>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <h2 class="bg-gray-800 text-white px-2 py-1">Editor</h2>
          <div id="editor" class="relative h-64"></div>
        </div>
        <div>
          <!-- <h2 class="px-2 py-1">
                    Requests to: <a id="domain" target="_blank" class="underline"></a>
                </h2>
                <div id="request-log" class="px-2 text-gray-600">No requests</div> -->
          TODO
        </div>
      </div>
      <div id="blocklyArea" class="w-full h-screen bg-red-500">
        <div id="blocklyDiv" style="position: absolute"></div>
      </div>
      <xml
        xmlns="https://developers.google.com/blockly/xml"
        id="toolbox"
        style="display: none"
      >
        <block type="program"></block>

        <block type="let"></block>
        <block type="var"></block>
        <block type="binary"></block>

        <!-- <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="controls_repeat_ext"></block>
        <block type="math_number">
          <field name="NUM">123</field>
        </block>
        <block type="math_arithmetic"></block>
        <block type="text_print"></block>
        <block type="string_length"></block> -->
        <block type="text"></block>
      </xml>
    </main>
    <script>
      Blockly.Blocks["program"] = {
        init: function () {
          this.jsonInit({
            message0: "Types %1",
            args0: [
              {
                type: "input_statement",
                name: "Types",
              },
            ],
            colour: 120,
            message1: "Run %1",
            args1: [
              {
                type: "input_value",
                name: "Expression",
              },
            ],
            // tooltip: "Returns number of letters in the provided text.",
            // helpUrl: "http://www.w3schools.com/jsref/jsref_length_string.asp",
          });
        },
      };
      Blockly.Blocks["let"] = {
        init: function () {
          this.jsonInit({
            message0: "let %1 = %2",
            args0: [
              {
                type: "field_value",
                name: "PATTERN",
                check: "Pattern",
              },
              {
                type: "input_value",
                name: "VALUE2",
              },
            ],
            message1: "in %1",
            args1: [
              {
                type: "input_value",
                name: "VALUE",
              },
            ],
            // nextStatement: "NODE",
            output: "Number",
            colour: 160,
            // tooltip: "Returns number of letters in the provided text.",
            // helpUrl: "http://www.w3schools.com/jsref/jsref_length_string.asp",
          });
        },
      };
      Blockly.Blocks["Destructure"] = {
        init: function () {
          this.jsonInit({
            message0: "Destructure %1",
            args0: [
              {
                type: "field_value",
                name: "VALUE",
                check: "String",
              },
            ],
            // output: "Number",
            previousStatement: "NODE",
            colour: 55,
            // tooltip: "Returns number of letters in the provided text.",
            // helpUrl: "http://www.w3schools.com/jsref/jsref_length_string.asp",
          });
        },
      };
      Blockly.Blocks["var"] = {
        init: function () {
          this.jsonInit({
            message0: "Var %1",
            args0: [
              {
                type: "field_value",
                name: "VALUE",
                check: "String",
              },
            ],
            // output: "Number",
            previousStatement: "NODE",
            colour: 55,
            // tooltip: "Returns number of letters in the provided text.",
            // helpUrl: "http://www.w3schools.com/jsref/jsref_length_string.asp",
          });
        },
      };
      Blockly.Blocks["binary"] = {
        init: function () {
          this.jsonInit({
            message0: "String %1",
            args0: [
              {
                type: "field_value",
                name: "VALUE",
                check: "String",
              },
            ],
            output: "Node",
            // previousStatement: "NODE",
            colour: 211,
            // tooltip: "Returns number of letters in the provided text.",
            // helpUrl: "http://www.w3schools.com/jsref/jsref_length_string.asp",
          });
        },
      };

      Blockly.Blocks["string_length"] = {
        init: function () {
          this.jsonInit({
            message0: "length of %1",
            args0: [
              {
                type: "input_value",
                name: "VALUE",
                check: "String",
              },
            ],
            output: "Number",
            colour: 160,
            tooltip: "Returns number of letters in the provided text.",
            helpUrl: "http://www.w3schools.com/jsref/jsref_length_string.asp",
          });
        },
      };

      var blocklyArea = document.getElementById("blocklyArea");
      var blocklyDiv = document.getElementById("blocklyDiv");
      var workspace = Blockly.inject(blocklyDiv, {
        toolbox: document.getElementById("toolbox"),
      });
      var onresize = function (e) {
        // Compute the absolute coordinates and dimensions of blocklyArea.
        var element = blocklyArea;
        var x = 0;
        var y = 0;
        do {
          x += element.offsetLeft;
          y += element.offsetTop;
          element = element.offsetParent;
        } while (element);
        // Position blocklyDiv over blocklyArea.
        blocklyDiv.style.left = x + "px";
        blocklyDiv.style.top = y + "px";
        blocklyDiv.style.width = blocklyArea.offsetWidth + "px";
        blocklyDiv.style.height = blocklyArea.offsetHeight + "px";
        Blockly.svgResize(workspace);
      };
      window.addEventListener("resize", onresize, false);
      onresize();
      Blockly.svgResize(workspace);
    </script>

    <script src="/main.js" type="module"></script>
    <!-- <script src="/gen/repro.js" type="module"></script> -->
  </body>
</html>
